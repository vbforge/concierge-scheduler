<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head(title=${isEdit ? 'Edit Concierge' : 'New Concierge'})}"></head>

<body>
<!-- Navbar -->
<nav th:replace="~{fragments/layout :: navbar}"></nav>

<div class="container-fluid content-wrapper">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <!-- Page Header -->
            <div class="card mb-4">
                <div class="card-body">
                    <h2 class="mb-0">
                        <i class="fas fa-user-plus" th:if="${!isEdit}"></i>
                        <i class="fas fa-user-edit" th:if="${isEdit}"></i>
                        <span th:text="${isEdit ? 'Edit Concierge' : 'Add New Concierge'}">Add Concierge</span>
                    </h2>
                    <p class="text-muted mb-0">
                        <span th:if="${!isEdit}">Create a new concierge staff member</span>
                        <span th:if="${isEdit}">Update concierge information</span>
                    </p>
                </div>
            </div>

            <!-- Flash Messages -->
            <div th:replace="~{fragments/layout :: messages}"></div>

            <!-- Form -->
            <div class="card">
                <div class="card-body">
                    <form th:action="${isEdit ? '/concierges/' + concierge.id : '/concierges'}"
                          th:object="${concierge}"
                          method="post">

                        <!-- CSRF Token -->
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                        <!-- Name Field -->
                        <div class="mb-3">
                            <label for="name" class="form-label">
                                <i class="fas fa-user"></i> Name *
                            </label>
                            <input type="text"
                                   class="form-control"
                                   th:classappend="${#fields.hasErrors('name') ? 'is-invalid' : ''}"
                                   id="name"
                                   th:field="*{name}"
                                   placeholder="Enter concierge name"
                                   required>
                            <div class="invalid-feedback" th:errors="*{name}">Name error</div>
                        </div>

                        <!-- Color Field -->
                        <div class="mb-3">
                            <label for="color" class="form-label">
                                <i class="fas fa-palette"></i> Color *
                            </label>
                            <select class="form-select"
                                    th:classappend="${#fields.hasErrors('color') ? 'is-invalid' : ''}"
                                    id="color"
                                    th:field="*{color}"
                                    required>
                                <option value="">Select a color...</option>
                                <option th:each="colorOption : ${colors}"
                                        th:value="${colorOption}"
                                        th:text="${colorOption.displayName}"
                                        th:style="'background-color: ' + ${colorOption.hexCode} + '; color: white;'">
                                    Color
                                </option>
                            </select>
                            <div class="invalid-feedback" th:errors="*{color}">Color error</div>
                        </div>

                        <!-- Active Field -->
                        <div class="mb-3 form-check">
                            <input type="checkbox"
                                   class="form-check-input"
                                   id="active"
                                   th:field="*{active}">
                            <label class="form-check-label" for="active">
                                <i class="fas fa-toggle-on"></i> Active
                            </label>
                        </div>

                        <!-- Color Preview -->
                        <div class="mb-3">
                            <label class="form-label">Preview</label>
                            <div class="p-3 rounded border"
                                 id="colorPreview"
                                 style="background-color: #f8f9fa;">
                                    <span class="badge" style="font-size: 1rem;">
                                        <span id="previewName">Preview Name</span>
                                    </span>
                            </div>
                        </div>

                        <!-- Buttons -->
                        <div class="d-flex justify-content-between">
                            <a href="/concierges" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i>
                                <span th:text="${isEdit ? 'Update' : 'Create'}">Create</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer th:replace="~{fragments/layout :: footer}"></footer>

<!-- Scripts -->
<th:block th:replace="~{fragments/layout :: scripts}"></th:block>

<!-- Form-specific Script -->
<script>
    // Update color preview
    function updatePreview() {
        const colorSelect = document.getElementById('color');
        const nameInput = document.getElementById('name');
        const preview = document.getElementById('colorPreview');
        const previewName = document.getElementById('previewName');

        if (colorSelect.value) {
            const selectedOption = colorSelect.options[colorSelect.selectedIndex];
            const hexColor = selectedOption.style.backgroundColor;
            preview.style.backgroundColor = hexColor + '33'; // 20% opacity
            preview.querySelector('.badge').style.backgroundColor = hexColor;
        }

        previewName.textContent = nameInput.value || 'Preview Name';
    }

    document.getElementById('color').addEventListener('change', updatePreview);
    document.getElementById('name').addEventListener('input', updatePreview);

    // Initialize preview
    updatePreview();
</script>
</body>
</html>